[
  {
    "name": "list_files",
    "description": "List all uploaded files with their sheet names, row counts, and column counts.",
    "input_schema": { "type": "object", "properties": {}, "required": [] }
  },
  {
    "name": "read_rows",
    "description": "Read actual cell values from specific rows of a file. Use this to understand file structure, headers, where data starts, what values look like. Returns array of rows with raw cell values. Numbers that look like dates (e.g. 45292) are Excel date serials.",
    "input_schema": {
      "type": "object",
      "properties": {
        "file": { "type": "string", "description": "File name or substring to match" },
        "sheet": { "type": "string", "description": "Sheet name (omit for first sheet)" },
        "start_row": { "type": "integer", "description": "Start row, 0-indexed" },
        "end_row": { "type": "integer", "description": "End row, exclusive. Max 50 rows per call." }
      },
      "required": ["file", "start_row", "end_row"]
    }
  },
  {
    "name": "get_column_stats",
    "description": "Get statistics for a column: data type distribution, unique values (for categorical columns), count of non-empty cells.",
    "input_schema": {
      "type": "object",
      "properties": {
        "file": { "type": "string", "description": "File name or substring" },
        "sheet": { "type": "string", "description": "Sheet name (omit for first)" },
        "column": { "type": "integer", "description": "Column index, 0-indexed" },
        "start_row": { "type": "integer", "description": "Start row for analysis (0-indexed, default 0)" }
      },
      "required": ["file", "column"]
    }
  },
  {
    "name": "find_rows",
    "description": "Search for rows where a column matches a value. Returns matching row indices and their full data.",
    "input_schema": {
      "type": "object",
      "properties": {
        "file": { "type": "string", "description": "File name or substring" },
        "sheet": { "type": "string", "description": "Sheet name" },
        "column": { "type": "integer", "description": "Column index to search" },
        "value": { "type": "string", "description": "Value to search for" },
        "max_results": { "type": "integer", "description": "Max results (default 10)" }
      },
      "required": ["file", "column", "value"]
    }
  },
  {
    "name": "compare_keys",
    "description": "Compare a key column between two files. Returns overlap count, keys only in file1, keys only in file2.",
    "input_schema": {
      "type": "object",
      "properties": {
        "file1": { "type": "string", "description": "First file name" },
        "sheet1": { "type": "string", "description": "Sheet name in file1 (omit for first)" },
        "col1": { "type": "integer", "description": "Key column in file1" },
        "start1": { "type": "integer", "description": "Data start row in file1" },
        "file2": { "type": "string", "description": "Second file name" },
        "sheet2": { "type": "string", "description": "Sheet name in file2 (omit for first)" },
        "col2": { "type": "integer", "description": "Key column in file2" },
        "start2": { "type": "integer", "description": "Data start row in file2" }
      },
      "required": ["file1", "col1", "start1", "file2", "col2", "start2"]
    }
  },
  {
    "name": "submit_report",
    "description": "Submit your exploration findings as a structured report. Call this when you have thoroughly explored all files and understand their structure, relationships, and any data issues.",
    "input_schema": {
      "type": "object",
      "properties": {
        "files": {
          "type": "array",
          "description": "Analysis of each file",
          "items": {
            "type": "object",
            "properties": {
              "name": { "type": "string" },
              "sheets": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "name": { "type": "string" },
                    "row_count": { "type": "integer" },
                    "col_count": { "type": "integer" },
                    "headers": { "type": "array", "items": { "type": "string" } },
                    "header_row": { "type": "integer", "description": "0-indexed row where headers are" },
                    "sample_rows": { "type": "array", "description": "3-5 representative data rows after headers" },
                    "data_types": { "type": "object", "description": "Column name to type mapping" },
                    "key_columns": { "type": "array", "items": { "type": "string" }, "description": "Columns with high uniqueness" },
                    "notable": { "type": "array", "items": { "type": "string" }, "description": "Observations" }
                  },
                  "required": ["name", "row_count", "col_count", "headers", "header_row"]
                }
              }
            },
            "required": ["name", "sheets"]
          }
        },
        "relationships": {
          "type": "array",
          "description": "Cross-file relationships discovered via compare_keys",
          "items": {
            "type": "object",
            "properties": {
              "file1": { "type": "string" },
              "file2": { "type": "string" },
              "sheet1": { "type": "string" },
              "sheet2": { "type": "string" },
              "join_key": { "type": "string" },
              "shared_count": { "type": "integer" },
              "only_in_file1": { "type": "integer" },
              "only_in_file2": { "type": "integer" },
              "match_rate": { "type": "string" }
            },
            "required": ["file1", "file2", "join_key"]
          }
        },
        "data_issues": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Warnings the code agent should know about"
        },
        "recommended_approach": {
          "type": "string",
          "description": "Natural language suggestion for how to solve the user's task"
        }
      },
      "required": ["files", "data_issues", "recommended_approach"]
    }
  },
  {
    "name": "generate_code",
    "description": "Submit the final JavaScript code to process the files. The code runs in a Web Worker with XLSX (SheetJS) and JSZip as globals. It must return { buffer: ArrayBuffer, filename: string }.",
    "input_schema": {
      "type": "object",
      "properties": {
        "code": { "type": "string", "description": "JavaScript async function body" },
        "filename": { "type": "string", "description": "Output filename for the xlsx" },
        "explanation": { "type": "string", "description": "Brief explanation of what the code does" }
      },
      "required": ["code", "filename"]
    }
  }
]
